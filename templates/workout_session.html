<!DOCTYPE html>
<html lang="en">
<head>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workout Session: {{ session_title }}</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles.css') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        function startTimer(duration, display) {
            var timer = duration, minutes, seconds;
            var interval = setInterval(function () {
                minutes = parseInt(timer / 60, 10);
                seconds = parseInt(timer % 60, 10);

                minutes = minutes < 10 ? "0" + minutes : minutes;
                seconds = seconds < 10 ? "0" + seconds : seconds;

                display.textContent = minutes + ":" + seconds;

                if (--timer < 0) {
                    clearInterval(interval);
                    display.textContent = "Rest over!";
                    document.getElementById('next-set').disabled = false; // Enable the next set button
                }
            }, 1000);
        }

        function completeSet(button, index) {
        var restPeriod = document.getElementById('rest' + index).value; // Ensure this ID exists
        var weight = document.getElementById('weight' + index).value; // Ensure this ID exists
        var display = document.getElementById('timer' + index); // Ensure this ID exists

        if (restPeriod && weight && display) {
            alert('Completed set with ' + weight + 'kg');
            startTimer(parseInt(restPeriod), display);
            button.disabled = true; // Disable button during the rest period
        } else {
            console.error("Error: Missing elements or values."); // Helps identify missing elements
        }
}

    </script>
</head>
<body>
    <header>
        <h1>Workout Session: {{ session_title }}</h1>
    </header>
    <main>
        <section>
            <form method="post" action="" enctype="multipart/form-data" class="upload-form">
                <input type="file" name="file" id="file-upload" class="file-input">
                <label for="file-upload" class="file-label">Choose a file</label>
                <button type="submit" class="upload-btn">Upload</button>
            </form>
            {% if image_url %}
                <img src="{{ image_url }}" alt="Uploaded Image" class="uploaded-image">
            {% endif %}
        </section>
        <section class="workouts">
            {% for workout in workouts %}
                <div class="workout" data-index="{{ loop.index }}" id="workout{{ loop.index }}">
                    <h2>{{ workout.exercise }}</h2>
                    <p>Sets: {{ workout.sets }} | Reps: {{ workout.reps }}</p>
                    <input type="number" id="weight{{ loop.index }}" class="weight-input" placeholder="Enter weight">
                    <input type="number" id="rest{{ loop.index }}" class="rest-input" value="{{ workout.rest }}" hidden>
                    <button onclick="completeSet(this, '{{ loop.index }}')" class="complete-btn">Complete Set</button>
                    <div id="timer{{ loop.index }}" class="timer">Rest Timer: 00:00</div>
                </div>
            {% endfor %}
        </section>
    </main>
    <footer>
        <a href="{{ url_for('home') }}" class="home-link">Return to Home</a>
    </footer>
</body>
</html>
