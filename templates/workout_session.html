<!DOCTYPE html>
<html lang="en">
<head>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workout Session</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles.css') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        function startTimer(duration, display) {
            var timer = duration, minutes, seconds;
            var interval = setInterval(function () {
                minutes = parseInt(timer / 60, 10);
                seconds = parseInt(timer % 60, 10);

                minutes = minutes < 10 ? "0" + minutes : minutes;
                seconds = seconds < 10 ? "0" + seconds : seconds;

                display.textContent = minutes + ":" + seconds;

                if (--timer < 0) {
                    clearInterval(interval);
                    display.textContent = "Rest over!";
                    // Optionally, you can enable the "Complete Set" button again or make other UI adjustments
                }
            }, 1000);
        }

        function completeSet(button) {
            var workoutDiv = button.closest('div');
            var restPeriod = workoutDiv.dataset.rest;
            var index = workoutDiv.dataset.index;
            var weight = document.getElementById('weight' + index).value;
            alert('Completed set with ' + weight + 'kg');

            var display = document.getElementById('timer' + index);
            startTimer(parseInt(restPeriod), display);
            button.disabled = true;  // Disable button during the rest period
        }
    </script>
</head>
<body>

    <form method="post" action="{{ url_for('upload_file') }}" enctype="multipart/form-data">
        <input type="file" name="file">
        <input type="submit" value="Upload">
    </form>
    
    {% for file in files %}
        {% if file.endswith(('png', 'jpg', 'jpeg', 'gif')) %}
            <img src="{{ url_for('static', filename='uploads/' + file) }}" alt="Motivational Image">
        {% elif file.endswith(('mp4', 'avi')) %}
            <video controls src="{{ url_for('static', filename='uploads/' + file) }}"></video>
        {% endif %}
    {% endfor %}

    <h1>Workout Session: {{ session_title }}</h1>

    <a href="{{ url_for('home') }}" class="button">Return to Home</a>

    {% for workout in workouts %}
        <div id="workout{{ loop.index }}" data-index="{{ loop.index }}" data-rest="{{ workout.rest }}">
            <h2>{{ workout.exercise }}</h2>
            <p>Sets: {{ workout.sets }} | Reps: {{ workout.reps }} | Rest: {{ workout.rest }}s</p>
            <input type="number" id="weight{{ loop.index }}" placeholder="Enter weight">
            <button onclick="completeSet(this)">Complete Set</button>
            <div id="timer{{ loop.index }}">Rest Timer: 00:00</div>
        </div>
    {% endfor %}
</body>
</html>
